<!-- Modal -->
<div class="modal fade" id="firstSubmitModal" tabindex="-1" aria-labelledby="firstSubmitModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content px-2">
            <div class="modal-header">
                <h5 class="modal-title" id="firstSubmitModalLabel">Submit as a draft</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" [formGroup]="firstSubmitForm">
                <div class="row mb-4">
                    <strong class="col-auto ms-2">Job identifier:</strong>
                    <span class="col-auto mx-2 badge bg-primary-dark">
                        {{firstSubmitForm.value["job_id"]}}
                    </span>
                </div>
                <div class="row mb-1">
                    <strong class="col-auto ms-2">Cover Letter:</strong>
                </div>
                <div class="row">
                    <div class="col input-group">
                        <textarea rows="4" class="form-control" formControlName="cover_letter"
                            placeholder="Insert your comment. Only for internal usage to inform biocurators."></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button [attr.disabled]="isSubmitting?true:null" type="button" class="btn btn-primary" (click)="submitFirst()">Submit</button>
            </div>
        </div>
    </div>
</div>

<!-- Main container -->
<div class="container-xl">
    <h2>Results</h2>
    <div class="alert alert-success">
        <div class="row align-items-center">
            <div class="col-md-auto">
                <p class="mb-0">
                    <strong>Job identifier</strong>
                    <span class="mx-2 badge bg-primary-dark">
                        {{resultsService.currentUUID}}
                    </span>
                </p>
            </div>
            <div class="col-md-auto" *ngIf="jobObj">
                <p class="mb-0">
                    <strong>Status</strong>
                    <span class="mx-2 badge"
                        [ngClass]="{'bg-danger': jobObj.status === 'failed', 'bg-success': jobObj.status === 'done', 'bg-warning': jobObj.status === 'running' }">
                        {{jobObj.status}}
                    </span>
                </p>
            </div>
            <div class="col text-end">
                <ng-container *ngIf="profileObj['role']">
                    <button *ngIf="!jobObj.draft_id" type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal"
                        data-bs-target="#firstSubmitModal">
                        Submit as draft
                    </button>
                    <p *ngIf="jobObj.draft_id" class="mb-0">
                        <strong>Job already submitted! Draft id:</strong>
                        <a class="mx-2 badge bg-primary" style="cursor: pointer;" role="button" target="_blank" routerLink="/draft/{{jobObj.draft_id}}">
                            {{jobObj.draft_id}}
                        </a>
                    </p>
                </ng-container>
                <div class="row align-items-center" *ngIf="!profileObj['role']">
                    <div class="col">
                        To deposit this ensemble, please log-in
                    </div>
                    <div class="col-auto">
                        <app-login></app-login>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <ng-container *ngIf="jobObj && (['done','failed'].includes(jobObj.status))">
        <app-result-page [entryObj]="entryObj"></app-result-page>
    </ng-container>


    <p class="mb-4"></p>

    <ng-container *ngIf="entryObj && entryObj['errors']">
        <div class="row mb-3" *ngFor="let currError of entryObj['errors'] ">
            <div class="col">
                <p class="text-danger mb-0"><strong>Type of error: </strong> {{currError['title']}}</p>
                <p><strong>Message: </strong> <br>
                    <span [innerHTML]="currError['message']"></span>
                </p>
            </div>
        </div>
    </ng-container>


    <div class="row" *ngIf="jobObj && (['running'].includes(jobObj.status))">
        <div class="col-8 mx-auto text-center">
            <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
            Running...
        </div>
    </div>
</div>